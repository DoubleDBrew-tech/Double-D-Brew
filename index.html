<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

  <nav class="navbar navbar-dark bg-primary mb-3">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">Double'd Brew Inventory</span>
      <div>
        <button class="btn btn-light btn-sm me-2" onclick="showDashboard()">Dashboard</button>
        <button class="btn btn-light btn-sm me-2" onclick="showProducts()">Products</button>
        <button class="btn btn-light btn-sm me-2" onclick="showLowStock()">Low Stock</button>
        <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
      </div>
    </div>
  </nav>

  <div class="container" id="main">
    <h3>Welcome to Double'd Brew Inventory System</h3>
    <p>Use the buttons above to manage products.</p>
  </div>

  <script type="module">
    // ------------------ FIREBASE CONFIG ------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let products = [];

    async function loadProducts() {
      const querySnapshot = await getDocs(collection(db, "products"));
      products = [];
      querySnapshot.forEach((doc) => {
        products.push({ id: doc.id, ...doc.data() });
      });
    }

    window.logout = function() {
      alert("Logged out successfully!");
      window.location.reload();
    }

    // ------------------ UI FUNCTIONS ------------------
    window.showDashboard = function() {
      document.getElementById("main").innerHTML = `
        <h3>Dashboard</h3>
        <p>Welcome to Double'd Brew Inventory Dashboard.</p>
        <p>Use the buttons above to add or view products.</p>
      `;
    };

    window.showProducts = async function() {
      await loadProducts();
      let rows = products.map(p => `
        <tr>
          <td>${p.sku}</td>
          <td>${p.name}</td>
          <td>${p.description || ""}</td>
          <td>${p.stock}</td>
          <td>₱${p.price.toFixed(2)}</td>
          <td>${p.reorder_threshold}</td>
        </tr>
      `).join("");

      document.getElementById("main").innerHTML = `
        <div class="d-flex justify-content-between mb-3">
          <h4>All Products</h4>
          <button class="btn btn-primary" onclick="addProduct()">Add Product</button>
        </div>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>SKU</th>
              <th>Name</th>
              <th>Description</th>
              <th>Stock</th>
              <th>Price</th>
              <th>Threshold</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    };

    window.addProduct = function() {
      document.getElementById("main").innerHTML = `
        <h4>Add New Product</h4>
        <form id="addForm">
          <input class="form-control mb-2" name="sku" placeholder="SKU" required>
          <input class="form-control mb-2" name="name" placeholder="Product Name" required>
          <input class="form-control mb-2" name="description" placeholder="Description">
          <input class="form-control mb-2" name="price" type="number" step="0.01" placeholder="Price" required>
          <input class="form-control mb-2" name="stock" type="number" placeholder="Stock" required>
          <input class="form-control mb-3" name="reorder" type="number" placeholder="Reorder Threshold" required>
          <button class="btn btn-success" type="submit">Save</button>
          <button class="btn btn-secondary ms-2" type="button" onclick="showProducts()">Cancel</button>
        </form>
      `;

      document.getElementById("addForm").addEventListener("submit", saveNewProduct);
    };

    async function saveNewProduct(e) {
      e.preventDefault();
      const form = e.target;
      const newProduct = {
        sku: form.sku.value,
        name: form.name.value,
        description: form.description.value,
        price: parseFloat(form.price.value),
        stock: parseInt(form.stock.value),
        reorder_threshold: parseInt(form.reorder.value)
      };

      await addDoc(collection(db, "products"), newProduct);
      alert("Product added successfully!");
      showProducts();
    }

    window.showLowStock = async function() {
      await loadProducts();
      let lowStock = products.filter(p => p.stock <= p.reorder_threshold);

      if (lowStock.length === 0) {
        document.getElementById("main").innerHTML = `
          <h4>Low Stock Products</h4>
          <p>No low stock products found.</p>
          <button class="btn btn-secondary" onclick="showDashboard()">Back</button>
        `;
        return;
      }

      let rows = lowStock.map(p => `
        <tr>
          <td>${p.sku}</td>
          <td>${p.name}</td>
          <td>${p.stock}</td>
          <td>₱${p.price.toFixed(2)}</td>
          <td>${p.reorder_threshold}</td>
        </tr>
      `).join("");

      document.getElementById("main").innerHTML = `
        <h4>Low Stock Products</h4>
        <table class="table table-striped">
          <thead><tr><th>SKU</th><th>Name</th><th>Stock</th><th>Price</th><th>Threshold</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
        <button class="btn btn-secondary" onclick="showDashboard()">Back</button>
      `;
    };
  </script>

</body>
</html>
